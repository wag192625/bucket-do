#!/bin/sh

commit_msg_file=$1
commit_msg=$(cat $1)

# commit -m ì˜µì…˜ ê°ì§€
if ! grep -q "^#" "$commit_msg_file"; then
    echo "âŒ 'git commit -m' ì˜µì…˜ì€ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤."
    echo "
ğŸ’¡ ë‹¤ìŒê³¼ ê°™ì´ í•©ë‹ˆë‹¤.
1. git commit (ì—”í„°)
2. í…œí”Œë¦¿ì— ë§ì¶° ì»¤ë°‹ ë©”ì„¸ì§€ ì‘ì„±
3. ì €ì¥ í›„ ì¢…ë£Œ
"
    exit 1
fi

# ------------------------------------------------------------------------
# ìœ„: -m ì˜µì…˜ ê°ì§€
# ì•„ë˜: ì´ìŠˆ ID ì¶”ì¶œ ë° ì¶”ê°€ ì‘ì„±
# ------------------------------------------------------------------------

commit_msg_file=$1
commit_msg=$(cat $1)

# ì£¼ì„ì„ ì œì™¸í•œ ì‹¤ì œ ë©”ì„¸ì§€ë§Œ ì¶”ì¶œ
filtered_msg=$(echo "$commit_msg" | grep -v '^#')
echo "ì›ë³¸ ì»¤ë°‹ ë©”ì„¸ì§€"
echo "$filtered_msg"

# í˜„ì¬ ë¸Œëœì¹˜ ì´ë¦„ ê°€ì ¸ì˜¤ê¸°
branch_name=$(git symbolic-ref --short HEAD 2>/dev/null || echo "")

# Jira ì´ìŠˆ ID ì¶”ì¶œ (ì˜ˆ: ISSUE-123)
issue_id=$(echo "$branch_name" | grep -oE '[A-Z]+-[0-9]+' || echo "")

# ì´ìŠˆ IDê°€ ìˆê³ , ì»¤ë°‹ ë©”ì„¸ì§€ì— ì´ìŠˆ IDê°€ ì—†ëŠ” ê²½ìš°ì—ë§Œ ì¶”ê°€
if [ ! -z "$issue_id" ] && ! echo "$commit_msg" | grep -q "\[$issue_id\]"; then
    commit_msg="[$issue_id] $commit_msg"
    echo "$commit_msg" > "$commit_msg_file"
fi

filtered_msg=$(echo "$commit_msg" | grep -v '^#')
echo "ìˆ˜ì •ëœ ì»¤ë°‹ ë©”ì„¸ì§€"
echo "$filtered_msg"


# ------------------------------------------------------------------------
# ìœ„: ì´ìŠˆ ID ì¶”ì¶œ ë° ì¶”ê°€ ì‘ì„±
# ì•„ë˜: ì»¤ë°‹ ë©”ì„¸ì§€ íŒ¨í„´ ê²€ì‚¬
# ------------------------------------------------------------------------

commit_msg_file=$1
commit_msg=$(cat $1)

filtered_msg=$(echo "$commit_msg" | grep -v '^#')
echo "ì»¤ë°‹ ë©”ì„¸ì§€"
echo "$filtered_msg"

# ì»¤ë°‹ ë©”ì„¸ì§€ íŒ¨í„´ ê²€ì‚¬
if ! echo "$commit_msg" | grep -qE '^\[([A-Z]+-[0-9]+)\]\s+(feat|fix|docs|style|refactor|test|chore): .+'; then
    echo "âŒ ì˜ëª»ëœ ì»¤ë°‹ ë©”ì„¸ì§€ í˜•ì‹ì…ë‹ˆë‹¤."
    echo "
    ì˜¬ë°”ë¥¸ ì»¤ë°‹ ë©”ì„¸ì§€ í˜•ì‹
    [ISSUE-123] feat: íšŒì›ê°€ì… API ê°œë°œ
    "
    exit 1
fi

